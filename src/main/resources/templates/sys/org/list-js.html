<script type="text/javascript">
$(function() {
	
	$.treeTable.init(orgOptions);
	
	// 删除时，按钮可以点击
    $('#bootstrap-treeTable').on('check.bs.table uncheck.bs.table load-success.bs.table ' +
            				 'check-all.bs.table uncheck-all.bs.table', function () {
        $('#remove').prop('disabled', ! $('#bootstrap-treeTable').bootstrapTable('getSelections').length);
    });
    
    // 新增按钮
    //$("#add").on('click', add);
    
    // 删除按钮
    //$("#remove").on('click', batRemove);
    
 	// 查询按钮
    $("#search").on('click', search);
    
    // 重置按钮
    $("#reset").on('click', reset);
	
});

var canLook_org = true;
var prefix_org = ctx + "sys/org";

var orgOptions = {
	id: "orgId",
    parentId: "parentId",
    url: prefix_org + "/data",
    createUrl: prefix_org + "/add/{id}",
    updateUrl: prefix_org + "/edit/{id}",
    //saveUrl: prefix_org + "/save",
    removeUrl: prefix_org + "/remove/{id}",
    modalName: "机构",
    columns: [{
        field: 'orgName',
        title: '机构名称',
        width: '350px'
    },
    {
        field: 'orgCode',
        title: '机构编号',
        align: "center",
        formatter: function(row, index) {
        	if(canLook_org) {
        		return '<a href="#" title="查看详情" onclick="lookOrg(\'' + row.orgId + '\')">' + row.orgCode + '</a>';
        	}
        	return row.orgCode;
        }
    },
    {
        field: 'orgMainCategroy',
        title: '机构大类',
        align: "center",
        width: '120px'
    },
    {
        field: 'orgSubCategroy',
        title: '机构细类',
        align: "center",
        width: '120px'
    },
    {
        field: 'sort',
        title: '排序',
        align: "center",
        width: '60px'
    },
    {
        field: 'createTime',
        title: '创建时间',
        align: "center"
    },
    {
        field: 'remarks',
        title: '机构描述'
    },
    {
        field: 'status',
        title: '状态',
        align: "center",
        width: '60px',
        formatter: function(row, index) {
            if (row.status == '1') {
                return '<span class="badge badge-primary">正常</span>';
            } else if (row.status == '2') {
                return '<span class="badge badge-danger">停用</span>';
            }
        }
    },
    {
        title: '操作',
        align: 'center',
        formatter: function(row, index) {
            if (row.parentId != 0) {
                var actions = [];
                actions.push('<a class="btn btn-primary btn-xs" title="添加子机构" href="#" onclick="addSub(\'' + row.orgId + '\')"><i class="fa fa-plus"></i></a> ');
                actions.push('<a class="btn btn-success btn-xs" title="编辑机构" href="#" onclick="edit(\'' + row.orgId + '\')"><i class="fa fa-edit"></i></a> ');
                actions.push('<a class="btn btn-danger btn-xs" title="删除机构" href="#" onclick="remove(\'' + row.orgId + '\')"><i class="fa fa-remove"></i></a>');
                return actions.join('');
            } else {
                return "";
            }
        }
    }]
};

//搜索
function search() {
	var params = $("#searchForm").serializeJSON();
	$.treeTable.refresh(params);
}

// 重置
function reset() {
	$("#searchForm input").val("");
  	$("#searchForm select").val("");
  	$.treeTable.refresh();
}

// 查看机构详情
function lookOrg(orgId) {
	$.operate.details(orgId);
}

// 添加子机构
function addSub(orgId) {
	
}

//添加子机构
function edit(orgId) {
	$.operate.edit(orgId);
}

// 删除机构
function remove(orgId) {
	console.log(orgId)
}
</script>